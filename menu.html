<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men칰 Punto de Venta</title>
    <link rel="stylesheet" href="stylemenu.css">
</head>

<body class="menu-layout">

    <nav class="sidebar">
        <button class="category-btn active" onclick="filtrarMenu('paquetes', this)">
            <div class="icon-circle">游꼼</div>
            <div class="cat-name">Paquetes</div>
        </button>
        <button class="category-btn" onclick="filtrarMenu('comida', this)">
            <div class="icon-circle">游꼢</div>
            <div class="cat-name">Comida</div>
        </button>
        <button class="category-btn" onclick="filtrarMenu('bebidas', this)">
            <div class="icon-circle">游볷</div>
            <div class="cat-name">Bebidas</div>
        </button>
        <button class="category-btn" onclick="filtrarMenu('postres', this)">
            <div class="icon-circle">游꼴</div>
            <div class="cat-name">Postres</div>
        </button>
    </nav>

    <div class="main-content">
        
        <header class="top-bar">
            <div style="color: #008000; font-size: 30px; margin-right: 10px;">游녻</div>
            <div class="user-badge" id="nombreUsuario">VISITANTE</div>
        </header>

        <div class="products-grid" id="gridProductos">
            </div>

        <div class="cart-section">
            
            <div class="cart-scroll-area">
                <div class="cart-title" id="cartTitle">CARRITO VACIO</div>
                <div id="cartItems"></div>
            </div>

            <div class="pay-panel">
                <div class="total-label">TOTAL:</div>
                <div class="total-amount" id="txtTotal">$0.00</div>
                <button class="btn-pay" onclick="abrirModalPago()">PAGAR</button>
            </div>

        </div>

    </div>

    <div id="modalTicket" class="modal-overlay">
        <div class="ticket-box">
            <h2 style="text-align: center; color: #008000; margin-bottom: 10px;">RESUMEN DE PEDIDO</h2>
            <div style="text-align: center; font-size: 0.8rem; margin-bottom: 10px;">Ticket de Venta</div>
            <hr style="border: 1px dashed #ccc;">
            
            <div id="ticketContent">
                </div>
            
            <hr style="border: 1px dashed #ccc;">
            <div class="ticket-total">
                TOTAL: <span id="ticketTotalDisplay">$0.00</span>
            </div>

            <div class="modal-buttons">
                <button class="btn-cancel" onclick="cerrarModal()">CANCELAR</button>
                <button class="btn-confirm" onclick="confirmarCompra()">CONFIRMAR E IMPRIMIR</button>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS ---
        const db = [
            { id: 1, cat: 'comida', name: 'HAMBURGUESA', price: 50 },
            { id: 2, cat: 'comida', name: 'TACOS', price: 60 },
            { id: 3, cat: 'comida', name: 'POZOLE', price: 45 },
            { id: 4, cat: 'comida', name: 'ENCHILADAS', price: 55 },
            { id: 5, cat: 'comida', name: 'QUESADILLAS', price: 30 },
            { id: 6, cat: 'comida', name: 'TORTA', price: 40 },
            { id: 7, cat: 'comida', name: 'SOPA', price: 25 },
            { id: 8, cat: 'comida', name: 'ENSALADA', price: 35 },
            { id: 10, cat: 'paquetes', name: 'PAQUETE 1', price: 80 },
            { id: 11, cat: 'paquetes', name: 'PAQUETE 2', price: 100 },
            { id: 20, cat: 'bebidas', name: 'REFRESCO', price: 20 },
            { id: 21, cat: 'bebidas', name: 'AGUA', price: 15 },
            { id: 30, cat: 'postres', name: 'DONA', price: 15 },
            { id: 31, cat: 'postres', name: 'HELADO', price: 20 },
        ];

        let carrito = [];

        window.onload = () => {
            const user = localStorage.getItem('usuarioActual');
            if(user) document.getElementById('nombreUsuario').innerText = user;
            filtrarMenu('comida', document.querySelectorAll('.category-btn')[1]);
        };

        function filtrarMenu(categoria, btn) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            const grid = document.getElementById('gridProductos');
            grid.innerHTML = '';

            const items = db.filter(i => i.cat === categoria);

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="food-img"></div>
                    <div class="food-title">${item.name}</div>
                    <div class="controls">
                        <div class="static-label">Cant</div>
                        <span class="qty-number" id="qty-${item.id}">0</span>
                        <button class="btn-pill" onclick="agregar(${item.id})">AGREGAR</button>
                    </div>
                `;
                grid.appendChild(card);
            });
            actualizarContadoresVisuales();
        }

        function agregar(id) {
            const item = db.find(i => i.id === id);
            carrito.push({...item, uniqueId: Date.now()}); 
            actualizarCarritoUI();
            actualizarContadoresVisuales();
        }

        function eliminarItem(uniqueId) {
            const index = carrito.findIndex(item => item.uniqueId === uniqueId);
            if (index > -1) {
                carrito.splice(index, 1);
            }
            actualizarCarritoUI();
            actualizarContadoresVisuales();
        }

        function actualizarContadoresVisuales() {
            db.forEach(dbItem => {
                const span = document.getElementById(`qty-${dbItem.id}`);
                if(span) span.innerText = "0";
            });

            const conteo = {};
            carrito.forEach(p => {
                conteo[p.id] = (conteo[p.id] || 0) + 1;
            });

            for (const [id, cantidad] of Object.entries(conteo)) {
                const span = document.getElementById(`qty-${id}`);
                if(span) span.innerText = cantidad;
            }
        }

        function actualizarCarritoUI() {
            const title = document.getElementById('cartTitle');
            const container = document.getElementById('cartItems');
            const txtTotal = document.getElementById('txtTotal');
            
            const total = carrito.reduce((acc, item) => acc + item.price, 0);
            txtTotal.innerText = `$${total}.00`;

            if(carrito.length > 0) {
                title.style.display = 'none'; 
                container.innerHTML = '';
                
                carrito.forEach((p) => {
                    const box = document.createElement('div');
                    box.className = 'cart-item-box';
                    box.innerHTML = `
                        <div style="font-weight:bold; font-size:0.8rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${p.name}</div>
                        <div style="font-size:0.9rem;">$${p.price}</div>
                        <button class="btn-delete" onclick="eliminarItem(${p.uniqueId})">X</button>
                    `;
                    container.appendChild(box);
                });
                container.scrollLeft = container.scrollWidth;
            } else {
                title.style.display = 'block';
                container.innerHTML = '';
            }
        }

        // --- FUNCIONES DEL TICKET Y PAGO ---

        function abrirModalPago() {
            if(carrito.length === 0) {
                alert("El carrito est치 vac칤o. Agrega productos antes de pagar.");
                return;
            }

            const modal = document.getElementById('modalTicket');
            const content = document.getElementById('ticketContent');
            const totalDisplay = document.getElementById('ticketTotalDisplay');

            // Limpiar contenido previo
            content.innerHTML = '';

            // Llenar lista de productos (Agrupando visualmente si quieres, o lista plana)
            carrito.forEach(item => {
                const row = document.createElement('div');
                row.className = 'ticket-row';
                row.innerHTML = `
                    <span>${item.name}</span>
                    <span>$${item.price}</span>
                `;
                content.appendChild(row);
            });

            // Calcular y mostrar total
            const total = carrito.reduce((acc, item) => acc + item.price, 0);
            totalDisplay.innerText = `$${total}.00`;

            // Mostrar el modal
            modal.style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modalTicket').style.display = 'none';
        }

        function confirmarCompra() {
            // 1. Abrir di치logo de impresi칩n
            window.print();

            // 2. Limpiar todo al terminar
            carrito = [];
            actualizarCarritoUI();
            actualizarContadoresVisuales();
            cerrarModal();
        }
    </script>

</body>
</html>